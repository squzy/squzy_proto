syntax = 'proto3';

package squzy.server.v1.service;

service Server {
    rpc GetList (GetListRequest) returns (GetListResponse);
    rpc AddScheduler (AddSchedulerRequest) returns (AddSchedulerResponse);
    rpc RemoveScheduler (RemoveSchedulerRequest) returns (RemoveSchedulerResponse);
    rpc RunScheduler (RunSchedulerRequest) returns (RunSchedulerResponse);
    rpc StopScheduler (StopSchedulerRequest) returns (StopSchedulerResponse);
}

enum Status {
    RUNNED = 0;
    STOPPED = 1;
}

message SchedulerListItem {
    string id = 1;
    Status status = 2;
}

message GetListRequest {
}

message GetListResponse {
    repeated SchedulerListItem list = 1;
}

message SiteMapCheck {
    string url = 1;
    int32 concurrency = 2;
}

message TcpCheck {
    string host = 1;
    int32 port = 2;
}

message GrpcCheck {
    string service = 1;
    string host = 2;
    int32 port = 3;
}

message HttpCheck {
    string method = 1;
    string url = 2;
    map<string, string> headers = 3;
    int32 statusCode = 4;
}

message MongoCheck {
    string url = 1;
}

message PostgresCheck {
    string dbName = 1;
    string host = 2;
    int32 port = 3;
    string user = 4;
    string password = 5;
}

message CassandraCheck {
    string cluster = 1;
    string user = 2;
    string password = 3;
}

message MysqlCheck {
    string dbName = 1;
    string host = 2;
    int32 port = 3;
    string user = 4;
    string password = 5;
}

message HttpJsonValueCheck {
    string method = 1;
    string url = 2;
    map<string, string> headers = 3;
    repeated Selectors selectors = 4;
    enum Type {
        String = 0;
        Bool = 1;
        Number = 2;
        Time = 3;
        Any = 4;
        Raw = 5;
    }
    message Selectors {
        Type type = 1;
        string path = 2;
    }
}

message AddSchedulerRequest {
    // How often we need execute check
    int32 interval = 1;
    // Timeout for check request
    int32 timeout = 2;
    oneof check {
        TcpCheck tcp_check = 3;
        SiteMapCheck sitemap_check = 4;
        GrpcCheck grpc_check = 5;
        HttpCheck http_check = 6;
        HttpJsonValueCheck http_json_value = 7;
    }
}

message AddSchedulerResponse {
    string id = 1;
}

message RemoveSchedulerRequest {
    string id = 1;
}

message RemoveSchedulerResponse {
    string id = 1;
}

message RunSchedulerRequest {
    string id = 1;
}

message StopSchedulerRequest {
    string id = 1;
}

message RunSchedulerResponse {
    string id = 1;
}

message StopSchedulerResponse {
    string id = 1;
}