syntax = 'proto3';

package squzy.v1.storage;

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";
import "squzy_proto/proto/v1/squzy_monitoring.proto";
import "squzy_proto/proto/v1/squzy_agent_server.proto";

service Storage {
    rpc SendResponseFromScheduler (SchedulerResponse) returns (SendResponseFromSchedulerRequest);
    rpc SendResponseFromAgent(stream SendResponseFromAgentRequest) returns (SendResponseFromAgentResponse);
}

message SendResponseFromAgentRequest {
    // generated by server
    string agentId = 1;
    // Should be set by user from env var
    string agentUniqName = 2;
    CpuInfo cpu_info = 3;
    MemoryInfo memory_info = 4;
    DiskInfo disk_info = 5;
    NetInfo net_info = 6;
    google.protobuf.Timestamp time = 7;
}

message SchedulerResponse {
    enum Code {
        OK = 0;
        Error = 1;
    }
    message Error {
        string message = 1;
    }
    message MetaData {
        google.protobuf.Timestamp startTime = 1;
        google.protobuf.Timestamp endTime = 2;
        google.protobuf.Value value = 3;
    }
    string schedulerId = 1;
    Code code = 2;
    squzy.v1.monitoring.Type type = 3;
    Error error = 4;
    MetaData meta = 5;
}

message CpuInfo {
    message CPU {
        double load = 1;
    }
    repeated CPU cpus = 1;
}

message MemoryInfo {
    message Memory {
        uint64 total = 1;
        uint64 used = 2;
        uint64 free = 3;
        uint64 shared = 4;
        double usedPercent = 5;
    }
    Memory mem = 1;
    Memory swap = 2;
}

message DiskInfo {
    message Disk {
        uint64 total = 1;
        uint64 free = 2;
        uint64 used = 3;
        double usedPercent = 4;
    }
    map<string, Disk> disks = 1;
}

message NetInfo {
    message Interface {
        uint64 bytesSent = 1;
        uint64 bytesRecv = 2;
        uint64 packetsSent = 3;
        uint64 packetsRecv = 4;
        // total number of errors while receiving
        uint64 errIn = 5;
        // total number of errors while sending
        uint64 errOut = 6;
        // total number of incoming packets which were dropped
        uint64 dropIn = 7;
        // total number of outgoing packets which were dropped (always 0 on OSX and BSD)
        uint64 dropOut = 8;
    }
    map<string, Interface> interfaces = 1;
}

message SendResponseFromSchedulerRequest{}

message SendResponseFromAgentResponse{}